% Correlation of solar panel power and light intensity
% Solar Power Experiment
% Karl Berger
% 2020.03.11

% to display fitted equation
% https://www.mathworks.com/matlabcentral/answers/...
% 401297-hello-how-do-i-display-the-equation-for-a-polyfit-line-on-this-plot

%%%% ENTER YOUR CHANNEL ID
readChannelID = 190041;

%%%% ENTER YOUR FIELD ASSIGNMENTS
fld1 = 1; % light intensity (lux)
fld2 = 4; % Panel power (mW)

%%%% ENTER THE NUMBER OF DAYS TO DISPLAY
dataDays = 1;

%% Read Data %%
% This method ensures that each parameter has the same number of points
data = thingSpeakRead(readChannelID, 'Fields',[fld1 fld2], ...
                     'NumDays', dataDays);
                                                   
% Extract the light intensity from the first column
x = data(:, 1) / 1000;  % convert to kilolux
% Extract the solar panel power from the second column
y = data(:, 2);

% fit a linear equation to the data. Force y-intercept to 0
slope = x(:) \ y(:);
fittedY = slope * x;

% visualize the data
hold on    % allow Scatter plot to overlay the equation Plot
scatter(x, y, 'or')  % plot as red circles
plot(x, fittedY, '-b', 'LineWidth', 2) % plot as blue line
grid on;

ylabel('Milliwatts');
xlabel('Lux');

caption = sprintf('mW = %g * klx', slope(1));    

dim = [.15 .6 .3 .3];
annotation('textbox', dim, 'String', caption, 'FitBoxToText', 'on');
